# 시스템 제약사항 및 기능

## 개요
이 문서는 도메인별로 분류된 MatZip 시스템의 주요 제약사항과 기능을 설명합니다.

## 도메인별 기능 및 제약사항

### User (사용자) 도메인

#### 제공 기능
- **고유 식별 시스템**: 사용자명과 이메일 기반 고유 식별
- **포괄적인 프로필 관리**: 개인정보, 연락처, 실명 관리
- **계정 상태 관리**: 활성/비활성 상태 전환 (`isActive` 플래그)
- **보안 인증 시스템**: 암호화된 비밀번호 관리
- **이메일 인증**: 토큰 기반 이메일 확인 시스템
- **비밀번호 재설정**: 만료 토큰을 통한 안전한 비밀번호 재설정
- **세션 추적**: 마지막 로그인 시간 기록

#### 제약사항
- **사용자명 고유성**: 시스템 전체에서 중복 불가
- **이메일 고유성**: 한 이메일당 하나의 계정만 허용
- **필수 필드**: 사용자명, 이메일, 비밀번호는 필수
- **토큰 만료**: 비밀번호 재설정 토큰은 만료일 존재

### UserHistory (사용자 이력) 도메인

#### 제공 기능
- **데이터 변경 추적**: 사용자 정보 수정 이력 완전 보존
- **감사 추적**: 언제, 누가 변경했는지 추적
- **롤백 지원**: 이전 상태로 복원 가능한 데이터 보관
- **규정 준수**: 사용자 데이터 변경에 대한 완전한 감사 로그

#### 제약사항
- **이력 보존**: 한번 생성된 이력은 수정/삭제 불가
- **사용자 연결**: 반드시 유효한 사용자 ID와 연결

### LoginHistory (로그인 이력) 도메인

#### 제공 기능
- **세션 관리**: 로그인/로그아웃 시간 추적
- **보안 모니터링**: IP 주소, 사용자 에이전트 기록
- **실패 분석**: 로그인 실패 원인 추적 및 기록
- **접속 패턴 분석**: 사용자별 접속 패턴 파악 가능
- **보안 감사**: 의심스러운 로그인 시도 탐지

#### 제약사항
- **필수 연결**: 반드시 유효한 사용자 ID와 연결
- **상태 제한**: 로그인 상태는 정의된 값만 허용
- **시간 순서**: 로그아웃 시간은 로그인 시간 이후여야 함

### MatZip (맛집) 도메인

#### 제공 기능
- **장소 정보 관리**: 이름, 주소, 상세 설명 저장
- **사용자 귀속**: 누가 추가했는지 명확한 소유권 추적
- **유연한 설명**: 자유로운 형식의 설명 필드
- **다중 리스트 포함**: 여러 리스트에 동시 포함 가능
- **태그 분류**: 다양한 태그로 분류 가능

#### 제약사항
- **필수 정보**: 이름과 주소는 필수 입력
- **추가자 추적**: 반드시 추가한 사용자 ID 기록
- **데이터 무결성**: 참조된 사용자는 유효해야 함

### Tag (태그) 도메인

#### 제공 기능
- **맞춤 분류**: 사용자 정의 태그 생성
- **시각적 구분**: 색상 코딩 시스템
- **개인화**: 사용자별 개별 태그 관리
- **다중 적용**: 하나의 태그를 여러 장소에 적용 가능
- **유연한 카테고리**: 자유로운 태그명 설정

#### 제약사항
- **생성자 추적**: 반드시 생성한 사용자 ID 기록
- **색상 제한**: 시스템에서 지원하는 색상 형식만 허용
- **태그명 필수**: 빈 태그명 허용하지 않음

### MatZipTag (맛집 태그) 도메인

#### 제공 기능
- **다대다 관계**: 장소와 태그 간 유연한 연결
- **적용자 추적**: 누가 태그를 적용했는지 기록
- **동적 분류**: 언제든지 태그 추가/제거 가능
- **중복 적용 방지**: 동일한 장소-태그 조합 중복 방지

#### 제약사항
- **유효성 검증**: 존재하는 장소와 태그만 연결 가능
- **적용자 필수**: 반드시 태그를 적용한 사용자 ID 기록
- **고유성**: 같은 장소-태그-사용자 조합은 하나만 허용

### MatZipList (맛집 리스트) 도메인

#### 제공 기능
- **개인 컬렉션**: 사용자별 장소 모음 관리
- **설명적 메타데이터**: 리스트명과 상세 설명 지원
- **소유권 관리**: 명확한 소유자 지정
- **공유 기능**: 다른 사용자와 공유 가능
- **히스토리 추적**: 모든 변경사항 기록

#### 제약사항
- **단일 소유자**: 한 번에 한 명의 소유자만 허용
- **소유자 존재**: 반드시 유효한 사용자가 소유자여야 함
- **리스트명 필수**: 빈 리스트명 허용하지 않음

### MatZipListItem (맛집 리스트 항목) 도메인

#### 제공 기능
- **유연한 구성**: 리스트 내용 동적 관리
- **추가자 추적**: 누가 항목을 추가했는지 기록
- **다중 포함**: 하나의 장소가 여러 리스트에 포함 가능
- **개별 관리**: 각 항목별 독립적 관리

#### 제약사항
- **유효성 검증**: 존재하는 리스트와 장소만 연결 가능
- **중복 방지**: 같은 리스트-장소 조합 중복 불가
- **추가자 필수**: 반드시 추가한 사용자 ID 기록

### MatZipListHistory (맛집 리스트 이력) 도메인

#### 제공 기능
- **변경 추적**: 리스트의 모든 변경사항 기록
- **변경 유형 분류**: 구체적인 변경 타입 구분
- **소유권 변경 추적**: 소유권 이전 시 이전자 기록
- **데이터 복원**: 이전 상태 정보 보존
- **감사 로그**: 완전한 변경 이력 제공

#### 제약사항
- **변경 유형 제한**: 다음 세 가지 값만 허용
    - `INFO_UPDATED`: 정보 업데이트
    - `OWNERSHIP_TRANSFERRED`: 소유권 이전
    - `LIST_CREATED`: 리스트 생성
- **이력 불변성**: 생성된 이력은 수정 불가
- **소유권 이전 추적**: 소유권 이전 시 이전자 정보 필수

### MatZipListShare (맛집 리스트 공유) 도메인

#### 제공 기능
- **세분화된 권한 제어**:
    - 리스트 정보 편집 권한 (`canEditListInfo`)
    - 리스트 항목 편집 권한 (`canEditListItems`)
    - 공유 사용자 편집 권한 (`canEditSharedUsers`)
- **다중 사용자 공유**: 여러 사용자와 동시 공유 가능
- **공유 이력 추적**: 언제 누가 공유했는지 기록
- **양방향 관계**: 공유자-피공유자 관계 명확히 구분
- **동적 권한 관리**: 공유 후에도 권한 수정 가능

#### 제약사항
- **유효한 사용자**: 공유자와 피공유자 모두 유효한 사용자여야 함
- **자기 공유 불가**: 자신에게는 공유할 수 없음
- **권한 필수**: 최소 하나의 권한은 부여해야 함
- **공유 시간 필수**: 공유 시점 기록 필수

## 시스템 전체 기능

### 감사 및 추적 시스템
- **포괄적인 감사 추적**: 모든 주요 작업에 대한 완전한 기록
- **사용자 귀속**: 모든 변경사항을 특정 사용자에게 연결
- **시간 추적**: 생성/수정 시간의 정확한 기록
- **변경 이력**: 중요한 엔티티의 변경 내역 보존

### 보안 시스템
- **토큰 기반 인증**: 안전한 이메일 인증 및 비밀번호 재설정
- **세션 보안**: IP 주소 및 사용자 에이전트 추적
- **접근 제어**: 세분화된 권한 기반 접근 제어
- **데이터 무결성**: 외래 키 제약을 통한 참조 무결성 보장

### 확장성 및 유지보수
- **모듈러 설계**: 각 도메인의 독립적 관리
- **표준화된 필드**: 일관된 감사 필드 사용
- **확장 가능한 구조**: 새로운 기능 추가 용이
- **성능 최적화**: 효율적인 인덱싱 및 쿼리 지원
